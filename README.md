# lain-day

> "我并非在回到过去。我是在进行一次‘数字考古’，挖掘被现代图形技术所遮蔽的、独特的审美和体验。"

`lain-day` 是一个在真实的终端（Terminal）环境中运行的交互式小说游戏。它的灵感来源于动画《玲音》（*Serial Experiments Lain*）的深层主题，旨在探索一种复古未来主义（Retrofuturism）的叙事方式。

这个项目的核心哲学是 **“用终端模拟游戏，而非用游戏引擎模拟终端”**。我们拥抱终端的限制，并将其作为创作的画笔，以挖掘一种更直接、更接近机器本质的交互体验。

## 项目理念与技术演进

本项目的技术选型演变，是其核心理念的直接体现。

### 第一阶段：Python - 快速原型与灵活性

项目最初采用Python开发。选择Python是基于其在**快速原型开发**上的巨大优势：

1.  **快速实现**：Python能够轻松地解析JSON和Markdown等数据文件，让我们迅速地搭建起一个由数据驱动的游戏框架，将叙事和玩法的设计想法快速转化为可运行的原型。
2.  **内容创作**：基于Python的动态特性，内容创作者可以简单地通过修改文本文件来添加新的游戏内容，极大地降低了创作门槛。
3.  **生态系统**：最初曾设想，项目需要利用Python庞大的第三方库（如音频处理），这是一个可靠的保障。

Python是实现这个项目从“0到1”的完美工具，它让我们可以专注于游戏概念本身。

### 第二阶段：转向C语言 - 追求控制与性能

随着开发的深入，我们发现，恰恰是Python的“优点”及其所处的`termux`目标环境，使我们**必须**转向C语言，以实现项目的最终愿景。

这次转向并非对Python的否定，而是一次必然的进化，其原因如下：

1.  **环境的再认识**：我们发现，最初作为依赖Python理由的音频等功能，实际上`termux`环境本身就可以直接支持。Python的必要性降低了。

2.  **性能的瓶颈**：在`termux`的软件渲染环境下，Python高层级的文本输出（`print`）在处理频繁的颜色和样式变更时，性能过低，导致交互体验迟滞。为了实现一个流畅、色彩丰富的终端界面，我们必须获得对**文本流（text stream）的底层控制能力**。

3.  **哲学的回归**：如果放弃对文本流的底层控制，就违背了“用终端模拟游戏”的初衷。C语言为我们提供了这种必需的、精确到字节的控制力，让我们能够真正地在终端这个“画布”上进行创作。

因此，项目当前及未来的开发，将**完全聚焦于C语言实现**。Python版本现在作为一份宝贵的原型和设计参考。

## 当前开发策略

在开发过程中，我们发现Python原型虽然灵活，但其“目的、目标和实现方法”高度混杂，导致系统难以测试和维护。特别是当内容的行为依赖于地图、角色状态、时间等复杂外部条件时，单纯的`.md`文件已无法满足预览和测试的需求。

为了解决这个问题，我们确立了新的开发策略：

1.  **强化职责分离**：利用C语言的严格性，构建一个职责清晰、数据与逻辑分离的健壮游戏引擎。
2.  **构建独立的“剧本预览器”**：作为重建引擎的第一步，我们将使用`CMake`创建一个独立编译的命令行工具。此工具将可以加载任意`.md`剧本文件，并在一个模拟的游戏状态下进行渲染和接口测试。这大大方便了对不同场景下内容的独立验证，是确保复杂场景（如“电车”场景）得以高质量实现的关键。

## 当前开发状态

项目目前为一个功能性的C语言引擎，其核心架构如下：

-   **引擎核心**：使用C语言编写，负责游戏主循环、状态管理、输入输出和动作执行。
-   **构建系统**：使用 `CMake` 进行项目构建。
-   **数据驱动**：核心游戏内容（场景、动作、物品、地图）依然由外部的 `.md` 和 `.json` 文件驱动，保持了内容创作的灵活性。
-   **第三方库**：目前集成了 `cJSON` 用于解析数据文件，以及 `zlib` 用于压缩功能。

一份详细、实时更新的开发状态清单（包括已完成、未完成和待办的功能）记录在 `include/project_status.h` 文件中。建议直接查阅该文件以了解项目进展的最新细节。

## 近期更新与新特性

-   **地图系统重构：** 将原 `map/` 目录下的数据文件迁移至 `old_map/`，为未来基于程序化定义的新地图系统做准备。
-   **动作系统优化：** 弃用 `actions.json` 文件，所有游戏动作（如场景切换、物品获取等）现已直接集成到 C 语言引擎逻辑中，提升了性能与控制力。
-   **精细化调试控制：**
    *   引入了**主调试开关 (`MASTER_DEBUG_SWITCH`)**，统一管理所有调试输出。
    *   新增了针对**通用日志 (`ENABLE_DEBUG_LOGGING`)**、**字符串 ID 调试 (`ENABLE_STRING_DEBUG_LOGGING`)** 和 **地图加载调试 (`ENABLE_MAP_DEBUG_LOGGING`)** 的独立开关，允许开发者按需启用特定类型的调试信息。
-   **显示效果控制：**
    *   添加了**屏幕清理开关 (`ENABLE_CLEAR_SCREEN`)**，可控制每次场景渲染时是否清屏，既可作为游戏风格选项，也可在调试时禁用以保留历史输出。
-   **`zlib` 压缩功能集成：** 引入 `external/zlib` 子模块，并在项目中添加了基于 `zlib` 的字符串压缩与解压缩工具函数，为未来的数据处理功能奠定基础。
-   **终端命令 (`arls`) 增强：** 改进了 `arls` 命令的输出，确保中文字符的正确显示和更好的可读性。

## 构建与运行

此外，为提升开发体验和游戏运行控制，项目已引入一套**可配置的调试与显示选项**。这些选项可以通过 CMake 进行精细控制，允许开发者根据需要开启或关闭详细的调试日志输出（包括通用日志、字符串ID日志、地图加载日志）以及游戏内的屏幕清理效果（打字机效果除外）。详细配置方法请参阅 `CMakeLists.txt` 中的相关注释。

## 构建与运行

```bash
# 1. 创建并进入build目录
mkdir -p build
cd build

# 2. 运行CMake生成构建文件
cmake ..

# 3. 编译项目
make

# 4. 运行游戏
./lain-day
```

游戏启动后，会提示您输入一个“会话名称”。您可以输入一个新名称来开始新游戏，或输入已有的名称来继续之前的游戏。所有游戏存档都保存在 `session/` 目录下，以会话名区分。
